#include "mbed.h"
#include "ultrasonic.h"
#include "HCSR04.h"

Serial pc(USBTX, USBRX);
Timer timer;

float getDistance_mm();
float Ultra_cm(void);

PinName pin_ECHO = PB_7; // Echo
PinName pin_TRIG = PB_0; // Trig

HCSR04 Ultra(pin_ECHO, pin_TRIG); // Sensor

int main() {
    uint16_t dist = 0;
 

    while(1) {
        dist = Ultra_cm();
        wait(0.5);
        pc.printf("Distance: %5.1f mm\n\r", Ultra.getDistance_mm());
        wait_ms(100 - timer.read_ms()); // time the loop
    }
}

float Ultra_cm(void)
{
    Ultra.startMeasurement();

    while(!Ultra.isNewDataReady());

    return Ultra.getDistance_cm();
}
